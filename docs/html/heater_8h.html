<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PotteryOven Kiln Controller: Core/Inc/heater.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PotteryOven Kiln Controller<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">STM32F030C8 pottery kiln controller with PID temperature control</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('heater_8h.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">heater.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Heater control module for kiln heating coils.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &quot;<a class="el" href="main_8h_source.html">main.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br />
<code>#include &quot;stm32f0xx_hal.h&quot;</code><br />
<code>#include &quot;arm_math.h&quot;</code><br />
<code>#include &quot;<a class="el" href="MAX31855_8h_source.html">MAX31855.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for heater.h:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="heater_8h__incl.svg" width="390" height="262"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="heater_8h__dep__incl.svg" width="275" height="112"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="heater_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-nested-classes" class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:heater_5Fcoil_5Ft" id="r_heater_5Fcoil_5Ft"><td class="memItemLeft">struct &#160;</td><td class="memItemRight"><a class="el" href="structheater__coil__t.html">heater_coil_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure for individual heating coil.  <a href="structheater__coil__t.html#details">More...</a><br /></td></tr>
<tr class="memitem:heater_5Fcoils_5Ft" id="r_heater_5Fcoils_5Ft"><td class="memItemLeft">struct &#160;</td><td class="memItemRight"><a class="el" href="structheater__coils__t.html">heater_coils_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure containing all three heating coils.  <a href="structheater__coils__t.html#details">More...</a><br /></td></tr>
<tr class="memitem:Heater_5FHandleTypeDef_5Ft" id="r_Heater_5FHandleTypeDef_5Ft"><td class="memItemLeft">struct &#160;</td><td class="memItemRight"><a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle structure for heater control.  <a href="structHeater__HandleTypeDef__t.html#details">More...</a><br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-define-members" class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a317b01705a0a50f953afb715b473fd84" id="r_a317b01705a0a50f953afb715b473fd84"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#a317b01705a0a50f953afb715b473fd84">PWM_ON_SECONDS</a>&#160;&#160;&#160;2</td></tr>
<tr class="memdesc:a317b01705a0a50f953afb715b473fd84"><td class="mdescLeft">&#160;</td><td class="mdescRight">PWM toggle period in seconds (coil stays on for this duration).  <br /></td></tr>
<tr class="memitem:a3cb676694bb157591763faaf5df6d11f" id="r_a3cb676694bb157591763faaf5df6d11f"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#a3cb676694bb157591763faaf5df6d11f">INTERUPT_INTERVAL_SECONDS</a>&#160;&#160;&#160;1</td></tr>
<tr class="memdesc:a3cb676694bb157591763faaf5df6d11f"><td class="mdescLeft">&#160;</td><td class="mdescRight">RTC alarm interval in seconds (must be &lt;= other intervals).  <br /></td></tr>
<tr class="memitem:a86f31d060a1457c2fca2021fcd696d5b" id="r_a86f31d060a1457c2fca2021fcd696d5b"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#a86f31d060a1457c2fca2021fcd696d5b">TEMPERATURE_SAMPLING_INTERVAL_SECONDS</a>&#160;&#160;&#160;1</td></tr>
<tr class="memdesc:a86f31d060a1457c2fca2021fcd696d5b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Temperature sampling interval in seconds.  <br /></td></tr>
<tr class="memitem:ac83009838eafe965466cfd4113b347b3" id="r_ac83009838eafe965466cfd4113b347b3"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#ac83009838eafe965466cfd4113b347b3">PID_CALC_INTERVAL_SECONDS</a>&#160;&#160;&#160;10</td></tr>
<tr class="memdesc:ac83009838eafe965466cfd4113b347b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">PID calculation interval in seconds.  <br /></td></tr>
<tr class="memitem:a425c5a717a6daefdc20039149d22edb2" id="r_a425c5a717a6daefdc20039149d22edb2"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#a425c5a717a6daefdc20039149d22edb2">HEATER_ENABLE_LOG</a></td></tr>
<tr class="memdesc:a425c5a717a6daefdc20039149d22edb2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable printf logs for heater module.  <br /></td></tr>
<tr class="memitem:a2daf20a17474d642c9d9c8671358ea95" id="r_a2daf20a17474d642c9d9c8671358ea95"><td class="memItemLeft">#define&#160;</td><td class="memItemRight"><a class="el" href="#a2daf20a17474d642c9d9c8671358ea95">MAX_MEAS_AR_LENGTH</a>&#160;&#160;&#160;20</td></tr>
<tr class="memdesc:a2daf20a17474d642c9d9c8671358ea95"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum length for temperature measurement arrays.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-enum-members" class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a416b9b028947266b58977ca87f661001" id="r_a416b9b028947266b58977ca87f661001"><td class="memItemLeft">enum &#160;</td><td class="memItemRight"><a class="el" href="#a416b9b028947266b58977ca87f661001">heater_coil_state_t</a> { <a class="el" href="#a416b9b028947266b58977ca87f661001aad54a0f140befbdf96cd97eb35b750eb">COIL_OFF</a> = 0
, <a class="el" href="#a416b9b028947266b58977ca87f661001aa00421aa3bbb60058dd6a78b9a9a9fec">COIL_ON</a> = 1
, <a class="el" href="#a416b9b028947266b58977ca87f661001abb7313b440c37ac6b7753fec2635676c">COIL_PWM</a> = 2
 }</td></tr>
<tr class="memdesc:a416b9b028947266b58977ca87f661001"><td class="mdescLeft">&#160;</td><td class="mdescRight">States that a heating coil can have.  <a href="#a416b9b028947266b58977ca87f661001">More...</a><br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a972087cb00b2551215bec518ee3a2646" id="r_a972087cb00b2551215bec518ee3a2646"><td class="memItemLeft">HAL_StatusTypeDef&#160;</td><td class="memItemRight"><a class="el" href="#a972087cb00b2551215bec518ee3a2646">initHeater</a> (<a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *<a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a>, <a class="el" href="structMAX31855__HandleTypeDef__t.html">MAX31855_HandleTypeDef_t</a> *<a class="el" href="main_8c.html#ac250f1fce66ec97006eeed7c9624030c">htemp</a>, GPIO_TypeDef *coil1_port, uint16_t coil1_pin, GPIO_TypeDef *coil2_port, uint16_t coil2_pin, GPIO_TypeDef *coil3_port, uint16_t coil3_pin)</td></tr>
<tr class="memdesc:a972087cb00b2551215bec518ee3a2646"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the heater module.  <br /></td></tr>
<tr class="memitem:aa845617288d221752fd94dbb011b564a" id="r_aa845617288d221752fd94dbb011b564a"><td class="memItemLeft">HAL_StatusTypeDef&#160;</td><td class="memItemRight"><a class="el" href="#aa845617288d221752fd94dbb011b564a">heater_set_level</a> (<a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *<a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a>, uint8_t level)</td></tr>
<tr class="memdesc:aa845617288d221752fd94dbb011b564a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the heater power level.  <br /></td></tr>
<tr class="memitem:aeb7b9057d5e38aaa7816e8c7f0b059e3" id="r_aeb7b9057d5e38aaa7816e8c7f0b059e3"><td class="memItemLeft">HAL_StatusTypeDef&#160;</td><td class="memItemRight"><a class="el" href="#aeb7b9057d5e38aaa7816e8c7f0b059e3">heater_set_state</a> (<a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *<a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a>)</td></tr>
<tr class="memdesc:aeb7b9057d5e38aaa7816e8c7f0b059e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply the configured heater state to GPIO outputs.  <br /></td></tr>
<tr class="memitem:a7f883e5fa8e1c1da14ca09afdca27036" id="r_a7f883e5fa8e1c1da14ca09afdca27036"><td class="memItemLeft">HAL_StatusTypeDef&#160;</td><td class="memItemRight"><a class="el" href="#a7f883e5fa8e1c1da14ca09afdca27036">heater_turn_off</a> (<a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *<a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a>)</td></tr>
<tr class="memdesc:a7f883e5fa8e1c1da14ca09afdca27036"><td class="mdescLeft">&#160;</td><td class="mdescRight">Turn off all heaters and reset to default state.  <br /></td></tr>
<tr class="memitem:ac2883f1108f7c28edb2c028a9e0f2639" id="r_ac2883f1108f7c28edb2c028a9e0f2639"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#ac2883f1108f7c28edb2c028a9e0f2639">heater_on_interupt</a> (<a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *<a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a>, RTC_HandleTypeDef *<a class="el" href="main_8c.html#aa0c7fca836406ade332e1e3f1039d8ab">hrtc</a>)</td></tr>
<tr class="memdesc:ac2883f1108f7c28edb2c028a9e0f2639"><td class="mdescLeft">&#160;</td><td class="mdescRight">RTC interrupt handler for temperature sampling and PID.  <br /></td></tr>
<tr class="memitem:aafa171e3ee132132560f2a851bb2ba7e" id="r_aafa171e3ee132132560f2a851bb2ba7e"><td class="memItemLeft">float32_t&#160;</td><td class="memItemRight"><a class="el" href="#aafa171e3ee132132560f2a851bb2ba7e">heater_calculate_slope</a> (<a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *<a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a>)</td></tr>
<tr class="memdesc:aafa171e3ee132132560f2a851bb2ba7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate temperature slope from sample buffer.  <br /></td></tr>
<tr class="memitem:a5e2e3fa0e798944d57a5bcc38822e5a9" id="r_a5e2e3fa0e798944d57a5bcc38822e5a9"><td class="memItemLeft">float32_t&#160;</td><td class="memItemRight"><a class="el" href="#a5e2e3fa0e798944d57a5bcc38822e5a9">heater_calculate_mean</a> (<a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *<a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a>)</td></tr>
<tr class="memdesc:a5e2e3fa0e798944d57a5bcc38822e5a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate mean temperature from sample buffer.  <br /></td></tr>
<tr class="memitem:a6d9ebb2503909ecffc49e9097c9a61a0" id="r_a6d9ebb2503909ecffc49e9097c9a61a0"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a6d9ebb2503909ecffc49e9097c9a61a0">heater_set_temperature_zero</a> (<a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *<a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a>)</td></tr>
<tr class="memdesc:a6d9ebb2503909ecffc49e9097c9a61a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clear the temperature sample buffer.  <br /></td></tr>
<tr class="memitem:a3ebedbe9a7aef79d70fb5e26f0b10abd" id="r_a3ebedbe9a7aef79d70fb5e26f0b10abd"><td class="memItemLeft">void&#160;</td><td class="memItemRight"><a class="el" href="#a3ebedbe9a7aef79d70fb5e26f0b10abd">heater_print_test</a> (RTC_HandleTypeDef *<a class="el" href="main_8c.html#aa0c7fca836406ade332e1e3f1039d8ab">hrtc</a>, float32_t temperature)</td></tr>
<tr class="memdesc:a3ebedbe9a7aef79d70fb5e26f0b10abd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print temperature with timestamp (debug function).  <br /></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Heater control module for kiln heating coils. </p>
<dl class="section author"><dt>Author</dt><dd>Dennis Rathgeb </dd></dl>
<dl class="section date"><dt>Date</dt><dd>Apr 5, 2024</dd></dl>
<p>Controls 3 heating coils with 7 power levels (0-6):</p><ul>
<li>Level 0: All coils OFF</li>
<li>Level 1: Coil1 PWM (50% duty)</li>
<li>Level 2: Coil1 ON</li>
<li>Level 3: Coil1 ON, Coil2 PWM</li>
<li>Level 4: Coil1+2 ON</li>
<li>Level 5: Coil1+2 ON, Coil3 PWM</li>
<li>Level 6: All coils ON</li>
</ul>
<p>PWM is implemented as manual toggle with PWM_ON_SECONDS period.</p>
<dl class="section user"><dt>Usage</dt><dd><ol type="1">
<li>Create a <a class="el" href="structHeater__HandleTypeDef__t.html" title="Handle structure for heater control.">Heater_HandleTypeDef_t</a> and call <a class="el" href="#a972087cb00b2551215bec518ee3a2646" title="Initialize the heater module.">initHeater()</a></li>
<li>Set desired level with <a class="el" href="#aa845617288d221752fd94dbb011b564a" title="Set the heater power level.">heater_set_level()</a></li>
<li>Call <a class="el" href="#aeb7b9057d5e38aaa7816e8c7f0b059e3" title="Apply the configured heater state to GPIO outputs.">heater_set_state()</a> periodically (more often than PWM_ON_SECONDS)</li>
<li>Use <a class="el" href="#a7f883e5fa8e1c1da14ca09afdca27036" title="Turn off all heaters and reset to default state.">heater_turn_off()</a> or set level 0 to stop heating</li>
</ol>
</dd></dl>
<dl class="section user"><dt>Door Safety</dt><dd>If door is opened (flag_door_open set), heater automatically goes to level 0 and resumes previous level when door closes. <a class="el" href="#aeb7b9057d5e38aaa7816e8c7f0b059e3" title="Apply the configured heater state to GPIO outputs.">heater_set_state()</a> must be called for this to take effect. </dd></dl>

<p class="definition">Definition in file <a class="el" href="heater_8h_source.html">heater.h</a>.</p>
</div><a name="doc-define-members" id="doc-define-members"></a><h2 id="header-doc-define-members" class="groupheader">Macro Definition Documentation</h2>
<a id="a425c5a717a6daefdc20039149d22edb2" name="a425c5a717a6daefdc20039149d22edb2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a425c5a717a6daefdc20039149d22edb2">&#9670;&#160;</a></span>HEATER_ENABLE_LOG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HEATER_ENABLE_LOG</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enable printf logs for heater module. </p>

<p class="definition">Definition at line <a class="el" href="heater_8h_source.html#l00054">54</a> of file <a class="el" href="heater_8h_source.html">heater.h</a>.</p>

</div>
</div>
<a id="a3cb676694bb157591763faaf5df6d11f" name="a3cb676694bb157591763faaf5df6d11f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cb676694bb157591763faaf5df6d11f">&#9670;&#160;</a></span>INTERUPT_INTERVAL_SECONDS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INTERUPT_INTERVAL_SECONDS&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>RTC alarm interval in seconds (must be &lt;= other intervals). </p>

<p class="definition">Definition at line <a class="el" href="heater_8h_source.html#l00037">37</a> of file <a class="el" href="heater_8h_source.html">heater.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="heater_8c_source.html#l00420">heater_on_interupt()</a>, and <a class="el" href="heater_8c_source.html#l00378">heater_set_temperature_zero()</a>.</p>

</div>
</div>
<a id="a2daf20a17474d642c9d9c8671358ea95" name="a2daf20a17474d642c9d9c8671358ea95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2daf20a17474d642c9d9c8671358ea95">&#9670;&#160;</a></span>MAX_MEAS_AR_LENGTH</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_MEAS_AR_LENGTH&#160;&#160;&#160;20</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maximum length for temperature measurement arrays. </p>

<p class="definition">Definition at line <a class="el" href="heater_8h_source.html#l00057">57</a> of file <a class="el" href="heater_8h_source.html">heater.h</a>.</p>

</div>
</div>
<a id="ac83009838eafe965466cfd4113b347b3" name="ac83009838eafe965466cfd4113b347b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac83009838eafe965466cfd4113b347b3">&#9670;&#160;</a></span>PID_CALC_INTERVAL_SECONDS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PID_CALC_INTERVAL_SECONDS&#160;&#160;&#160;10</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>PID calculation interval in seconds. </p>

<p class="definition">Definition at line <a class="el" href="heater_8h_source.html#l00043">43</a> of file <a class="el" href="heater_8h_source.html">heater.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="heater_8c_source.html#l00360">heater_calculate_mean()</a>, <a class="el" href="heater_8c_source.html#l00331">heater_calculate_slope()</a>, <a class="el" href="heater_8c_source.html#l00420">heater_on_interupt()</a>, and <a class="el" href="heater_8c_source.html#l00378">heater_set_temperature_zero()</a>.</p>

</div>
</div>
<a id="a317b01705a0a50f953afb715b473fd84" name="a317b01705a0a50f953afb715b473fd84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a317b01705a0a50f953afb715b473fd84">&#9670;&#160;</a></span>PWM_ON_SECONDS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PWM_ON_SECONDS&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>PWM toggle period in seconds (coil stays on for this duration). </p>

<p class="definition">Definition at line <a class="el" href="heater_8h_source.html#l00034">34</a> of file <a class="el" href="heater_8h_source.html">heater.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="heater_8c_source.html#l00116">heater_update_pwm_coil()</a>.</p>

</div>
</div>
<a id="a86f31d060a1457c2fca2021fcd696d5b" name="a86f31d060a1457c2fca2021fcd696d5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86f31d060a1457c2fca2021fcd696d5b">&#9670;&#160;</a></span>TEMPERATURE_SAMPLING_INTERVAL_SECONDS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TEMPERATURE_SAMPLING_INTERVAL_SECONDS&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Temperature sampling interval in seconds. </p>

<p class="definition">Definition at line <a class="el" href="heater_8h_source.html#l00040">40</a> of file <a class="el" href="heater_8h_source.html">heater.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="heater_8c_source.html#l00360">heater_calculate_mean()</a>, <a class="el" href="heater_8c_source.html#l00331">heater_calculate_slope()</a>, and <a class="el" href="heater_8c_source.html#l00420">heater_on_interupt()</a>.</p>

</div>
</div>
<a name="doc-enum-members" id="doc-enum-members"></a><h2 id="header-doc-enum-members" class="groupheader">Enumeration Type Documentation</h2>
<a id="a416b9b028947266b58977ca87f661001" name="a416b9b028947266b58977ca87f661001"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a416b9b028947266b58977ca87f661001">&#9670;&#160;</a></span>heater_coil_state_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="#a416b9b028947266b58977ca87f661001">heater_coil_state_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>States that a heating coil can have. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a416b9b028947266b58977ca87f661001aad54a0f140befbdf96cd97eb35b750eb" name="a416b9b028947266b58977ca87f661001aad54a0f140befbdf96cd97eb35b750eb"></a>COIL_OFF&#160;</td><td class="fielddoc"><p>Coil is off </p>
</td></tr>
<tr><td class="fieldname"><a id="a416b9b028947266b58977ca87f661001aa00421aa3bbb60058dd6a78b9a9a9fec" name="a416b9b028947266b58977ca87f661001aa00421aa3bbb60058dd6a78b9a9a9fec"></a>COIL_ON&#160;</td><td class="fielddoc"><p>Coil is continuously on </p>
</td></tr>
<tr><td class="fieldname"><a id="a416b9b028947266b58977ca87f661001abb7313b440c37ac6b7753fec2635676c" name="a416b9b028947266b58977ca87f661001abb7313b440c37ac6b7753fec2635676c"></a>COIL_PWM&#160;</td><td class="fielddoc"><p>Coil is in PWM mode (50% duty cycle) </p>
</td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="heater_8h_source.html#l00062">62</a> of file <a class="el" href="heater_8h_source.html">heater.h</a>.</p>

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="a5e2e3fa0e798944d57a5bcc38822e5a9" name="a5e2e3fa0e798944d57a5bcc38822e5a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e2e3fa0e798944d57a5bcc38822e5a9">&#9670;&#160;</a></span>heater_calculate_mean()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float32_t heater_calculate_mean </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *</td>          <td class="paramname"><span class="paramname"><em>hheater</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate mean temperature from sample buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a></td><td>Pointer to heater handle </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Mean temperature in degrees C</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a></td><td>Pointer to heater handle </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Mean temperature in degrees C</dd></dl>
<p>Uses CMSIS-DSP arm_mean_f32 for efficient calculation. </p>

<p class="definition">Definition at line <a class="el" href="heater_8c_source.html#l00360">360</a> of file <a class="el" href="heater_8c_source.html">heater.c</a>.</p>

<p class="reference">References <a class="el" href="main_8c_source.html#l00076">hheater</a>, <a class="el" href="heater_8h_source.html#l00043">PID_CALC_INTERVAL_SECONDS</a>, and <a class="el" href="heater_8h_source.html#l00040">TEMPERATURE_SAMPLING_INTERVAL_SECONDS</a>.</p>

<p class="reference">Referenced by <a class="el" href="heater_8c_source.html#l00420">heater_on_interupt()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="heater_8h_a5e2e3fa0e798944d57a5bcc38822e5a9_icgraph.svg" width="607" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aafa171e3ee132132560f2a851bb2ba7e" name="aafa171e3ee132132560f2a851bb2ba7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aafa171e3ee132132560f2a851bb2ba7e">&#9670;&#160;</a></span>heater_calculate_slope()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float32_t heater_calculate_slope </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *</td>          <td class="paramname"><span class="paramname"><em>hheater</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate temperature slope from sample buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a></td><td>Pointer to heater handle </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Temperature slope in degrees C per second</dd></dl>
<p>Uses linear regression to calculate the temperature rate of change from the stored temperature samples.</p>
<p>Calculate temperature slope from sample buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a></td><td>Pointer to heater handle </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Temperature slope in degrees C per second</dd></dl>
<p>Uses the least squares method to fit a line to the temperature samples: slope = sum((t - mean_t) * (T - mean_T)) / sum((t - mean_t)^2)</p>
<p>Where t is time and T is temperature. </p>

<p class="definition">Definition at line <a class="el" href="heater_8c_source.html#l00331">331</a> of file <a class="el" href="heater_8c_source.html">heater.c</a>.</p>

<p class="reference">References <a class="el" href="main_8c_source.html#l00076">hheater</a>, <a class="el" href="heater_8h_source.html#l00043">PID_CALC_INTERVAL_SECONDS</a>, and <a class="el" href="heater_8h_source.html#l00040">TEMPERATURE_SAMPLING_INTERVAL_SECONDS</a>.</p>

<p class="reference">Referenced by <a class="el" href="heater_8c_source.html#l00420">heater_on_interupt()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="heater_8h_aafa171e3ee132132560f2a851bb2ba7e_icgraph.svg" width="606" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ac2883f1108f7c28edb2c028a9e0f2639" name="ac2883f1108f7c28edb2c028a9e0f2639"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2883f1108f7c28edb2c028a9e0f2639">&#9670;&#160;</a></span>heater_on_interupt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void heater_on_interupt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *</td>          <td class="paramname"><span class="paramname"><em>hheater</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">RTC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>hrtc</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>RTC interrupt handler for temperature sampling and PID. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a></td><td>Pointer to heater handle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="main_8c.html#aa0c7fca836406ade332e1e3f1039d8ab">hrtc</a></td><td>Pointer to RTC handle for timestamp</td></tr>
  </table>
  </dd>
</dl>
<p>Called from RTC alarm interrupt (every INTERUPT_INTERVAL_SECONDS). Performs:</p><ul>
<li>Temperature sampling (every TEMPERATURE_SAMPLING_INTERVAL_SECONDS)</li>
<li>Slope and mean calculation (every PID_CALC_INTERVAL_SECONDS)</li>
<li>PID calculation (TODO: not yet implemented)</li>
</ul>
<p>RTC interrupt handler for temperature sampling and PID.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a></td><td>Pointer to heater handle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="main_8c.html#aa0c7fca836406ade332e1e3f1039d8ab">hrtc</a></td><td>Pointer to RTC handle</td></tr>
  </table>
  </dd>
</dl>
<p>Called from RTC alarm interrupt every INTERUPT_INTERVAL_SECONDS.</p>
<p>Operation:</p><ol type="1">
<li>Increment time counter</li>
<li>At TEMPERATURE_SAMPLING_INTERVAL: read and store temperature</li>
<li><p class="startli">At PID_CALC_INTERVAL: calculate slope and mean, then reset</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo</a></b></dt><dd>Implement actual PID calculation and heater level adjustment </dd></dl>
</li>
</ol>

<p class="definition">Definition at line <a class="el" href="heater_8c_source.html#l00420">420</a> of file <a class="el" href="heater_8c_source.html">heater.c</a>.</p>

<p class="reference">References <a class="el" href="heater_8c_source.html#l00360">heater_calculate_mean()</a>, <a class="el" href="heater_8c_source.html#l00331">heater_calculate_slope()</a>, <a class="el" href="heater_8c_source.html#l00395">heater_print_test()</a>, <a class="el" href="heater_8c_source.html#l00378">heater_set_temperature_zero()</a>, <a class="el" href="main_8c_source.html#l00076">hheater</a>, <a class="el" href="main_8c_source.html#l00058">hrtc</a>, <a class="el" href="heater_8h_source.html#l00037">INTERUPT_INTERVAL_SECONDS</a>, <a class="el" href="MAX31855_8c_source.html#l00151">max31855_get_temp_f32()</a>, <a class="el" href="MAX31855_8c_source.html#l00076">max31855_read_data()</a>, <a class="el" href="heater_8h_source.html#l00043">PID_CALC_INTERVAL_SECONDS</a>, and <a class="el" href="heater_8h_source.html#l00040">TEMPERATURE_SAMPLING_INTERVAL_SECONDS</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00573">HAL_RTC_AlarmAEventCallback()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="heater_8h_ac2883f1108f7c28edb2c028a9e0f2639_cgraph.svg" width="606" height="291"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="heater_8h_ac2883f1108f7c28edb2c028a9e0f2639_icgraph.svg" width="404" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a3ebedbe9a7aef79d70fb5e26f0b10abd" name="a3ebedbe9a7aef79d70fb5e26f0b10abd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ebedbe9a7aef79d70fb5e26f0b10abd">&#9670;&#160;</a></span>heater_print_test()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void heater_print_test </td>
          <td>(</td>
          <td class="paramtype">RTC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>hrtc</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float32_t</td>          <td class="paramname"><span class="paramname"><em>temperature</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print temperature with timestamp (debug function). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="main_8c.html#aa0c7fca836406ade332e1e3f1039d8ab">hrtc</a></td><td>Pointer to RTC handle for timestamp </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">temperature</td><td>Temperature value to print</td></tr>
  </table>
  </dd>
</dl>
<p>Print temperature with timestamp (debug function).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="main_8c.html#aa0c7fca836406ade332e1e3f1039d8ab">hrtc</a></td><td>Pointer to RTC handle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">temperature</td><td>Temperature value to print</td></tr>
  </table>
  </dd>
</dl>
<p>Output format: HH:MM:SS,temperature Used for logging temperature data to UART. </p>

<p class="definition">Definition at line <a class="el" href="heater_8c_source.html#l00395">395</a> of file <a class="el" href="heater_8c_source.html">heater.c</a>.</p>

<p class="reference">References <a class="el" href="main_8c_source.html#l00058">hrtc</a>.</p>

<p class="reference">Referenced by <a class="el" href="heater_8c_source.html#l00420">heater_on_interupt()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="heater_8h_a3ebedbe9a7aef79d70fb5e26f0b10abd_icgraph.svg" width="570" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aa845617288d221752fd94dbb011b564a" name="aa845617288d221752fd94dbb011b564a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa845617288d221752fd94dbb011b564a">&#9670;&#160;</a></span>heater_set_level()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef heater_set_level </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *</td>          <td class="paramname"><span class="paramname"><em>hheater</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>level</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the heater power level. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a></td><td>Pointer to heater handle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">level</td><td>Power level (0-6) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>HAL_OK on success, HAL_ERROR for invalid level</dd></dl>
<p>Configures coil states according to the level mapping:</p><ul>
<li>0: All OFF</li>
<li>1: Coil1 PWM</li>
<li>2: Coil1 ON</li>
<li>3: Coil1 ON, Coil2 PWM</li>
<li>4: Coil1+2 ON</li>
<li>5: Coil1+2 ON, Coil3 PWM</li>
<li>6: All ON</li>
</ul>
<p>Set the heater power level.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a></td><td>Pointer to heater handle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">level</td><td>Power level (0-6) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>HAL_OK on success, HAL_ERROR for invalid level</dd></dl>
<p>Level to coil state mapping: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Level  </th><th class="markdownTableHeadNone">Coil1  </th><th class="markdownTableHeadNone">Coil2  </th><th class="markdownTableHeadNone">Coil3  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0  </td><td class="markdownTableBodyNone">OFF  </td><td class="markdownTableBodyNone">OFF  </td><td class="markdownTableBodyNone">OFF  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">PWM  </td><td class="markdownTableBodyNone">OFF  </td><td class="markdownTableBodyNone">OFF  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">ON  </td><td class="markdownTableBodyNone">OFF  </td><td class="markdownTableBodyNone">OFF  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">ON  </td><td class="markdownTableBodyNone">PWM  </td><td class="markdownTableBodyNone">OFF  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">ON  </td><td class="markdownTableBodyNone">ON  </td><td class="markdownTableBodyNone">OFF  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5  </td><td class="markdownTableBodyNone">ON  </td><td class="markdownTableBodyNone">ON  </td><td class="markdownTableBodyNone">PWM  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">6  </td><td class="markdownTableBodyNone">ON  </td><td class="markdownTableBodyNone">ON  </td><td class="markdownTableBodyNone">ON  </td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="heater_8c_source.html#l00252">252</a> of file <a class="el" href="heater_8c_source.html">heater.c</a>.</p>

<p class="reference">References <a class="el" href="heater_8h_source.html#l00064">COIL_OFF</a>, <a class="el" href="heater_8h_source.html#l00065">COIL_ON</a>, <a class="el" href="heater_8h_source.html#l00066">COIL_PWM</a>, and <a class="el" href="main_8c_source.html#l00076">hheater</a>.</p>

<p class="reference">Referenced by <a class="el" href="heater_8c_source.html#l00179">heater_check_door_state()</a>, <a class="el" href="heater_8c_source.html#l00225">heater_turn_off()</a>, and <a class="el" href="main_8c_source.html#l00112">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" loading="lazy" frameborder="0" src="heater_8h_aa845617288d221752fd94dbb011b564a_icgraph.svg" width="100%" height="404"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="aeb7b9057d5e38aaa7816e8c7f0b059e3" name="aeb7b9057d5e38aaa7816e8c7f0b059e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb7b9057d5e38aaa7816e8c7f0b059e3">&#9670;&#160;</a></span>heater_set_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef heater_set_state </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *</td>          <td class="paramname"><span class="paramname"><em>hheater</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Apply the configured heater state to GPIO outputs. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a></td><td>Pointer to heater handle </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>HAL_OK on success</dd></dl>
<p>Must be called periodically (more often than PWM_ON_SECONDS) to:</p><ul>
<li>Update PWM toggling for coils in PWM mode</li>
<li>Check door state and pause/resume heating</li>
</ul>
<p>Apply the configured heater state to GPIO outputs.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a></td><td>Pointer to heater handle </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>HAL_OK on success</dd></dl>
<p>Checks door state first, then updates all three coils. Must be called periodically for PWM to work correctly. </p>

<p class="definition">Definition at line <a class="el" href="heater_8c_source.html#l00307">307</a> of file <a class="el" href="heater_8c_source.html">heater.c</a>.</p>

<p class="reference">References <a class="el" href="heater_8c_source.html#l00179">heater_check_door_state()</a>, <a class="el" href="heater_8c_source.html#l00141">heater_set_coil_state()</a>, and <a class="el" href="main_8c_source.html#l00076">hheater</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00583">HAL_GPIO_EXTI_Callback()</a>, and <a class="el" href="main_8c_source.html#l00112">main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" loading="lazy" frameborder="0" src="heater_8h_aeb7b9057d5e38aaa7816e8c7f0b059e3_cgraph.svg" width="100%" height="442"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="heater_8h_aeb7b9057d5e38aaa7816e8c7f0b059e3_icgraph.svg" width="360" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a6d9ebb2503909ecffc49e9097c9a61a0" name="a6d9ebb2503909ecffc49e9097c9a61a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d9ebb2503909ecffc49e9097c9a61a0">&#9670;&#160;</a></span>heater_set_temperature_zero()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void heater_set_temperature_zero </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *</td>          <td class="paramname"><span class="paramname"><em>hheater</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clear the temperature sample buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a></td><td>Pointer to heater handle</td></tr>
  </table>
  </dd>
</dl>
<p>Sets all elements in the temperature array to zero.</p>
<p>Clear the temperature sample buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a></td><td>Pointer to heater handle</td></tr>
  </table>
  </dd>
</dl>
<p>Sets all elements in the temperature array to zero. </p>

<p class="definition">Definition at line <a class="el" href="heater_8c_source.html#l00378">378</a> of file <a class="el" href="heater_8c_source.html">heater.c</a>.</p>

<p class="reference">References <a class="el" href="main_8c_source.html#l00076">hheater</a>, <a class="el" href="heater_8h_source.html#l00037">INTERUPT_INTERVAL_SECONDS</a>, and <a class="el" href="heater_8h_source.html#l00043">PID_CALC_INTERVAL_SECONDS</a>.</p>

<p class="reference">Referenced by <a class="el" href="heater_8c_source.html#l00420">heater_on_interupt()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="heater_8h_a6d9ebb2503909ecffc49e9097c9a61a0_icgraph.svg" width="642" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7f883e5fa8e1c1da14ca09afdca27036" name="a7f883e5fa8e1c1da14ca09afdca27036"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f883e5fa8e1c1da14ca09afdca27036">&#9670;&#160;</a></span>heater_turn_off()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef heater_turn_off </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *</td>          <td class="paramname"><span class="paramname"><em>hheater</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Turn off all heaters and reset to default state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname"><a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a></td><td>Pointer to heater handle </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>HAL_OK on success </dd></dl>

<p class="definition">Definition at line <a class="el" href="heater_8c_source.html#l00225">225</a> of file <a class="el" href="heater_8c_source.html">heater.c</a>.</p>

<p class="reference">References <a class="el" href="heater_8c_source.html#l00023">heater_set_default_params()</a>, <a class="el" href="heater_8c_source.html#l00252">heater_set_level()</a>, and <a class="el" href="main_8c_source.html#l00076">hheater</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="heater_8h_a7f883e5fa8e1c1da14ca09afdca27036_cgraph.svg" width="295" height="104"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a972087cb00b2551215bec518ee3a2646" name="a972087cb00b2551215bec518ee3a2646"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a972087cb00b2551215bec518ee3a2646">&#9670;&#160;</a></span>initHeater()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef initHeater </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structHeater__HandleTypeDef__t.html">Heater_HandleTypeDef_t</a> *</td>          <td class="paramname"><span class="paramname"><em>hheater</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structMAX31855__HandleTypeDef__t.html">MAX31855_HandleTypeDef_t</a> *</td>          <td class="paramname"><span class="paramname"><em>htemp</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GPIO_TypeDef *</td>          <td class="paramname"><span class="paramname"><em>coil1_port</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>coil1_pin</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GPIO_TypeDef *</td>          <td class="paramname"><span class="paramname"><em>coil2_port</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>coil2_pin</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">GPIO_TypeDef *</td>          <td class="paramname"><span class="paramname"><em>coil3_port</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>coil3_pin</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the heater module. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname"><a class="el" href="main_8c.html#ac022f19ff309f00e834e6ebd4466aed3">hheater</a></td><td>Pointer to heater handle to initialize </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname"><a class="el" href="main_8c.html#ac250f1fce66ec97006eeed7c9624030c">htemp</a></td><td>Pointer to MAX31855 temperature sensor handle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coil1_port</td><td>GPIO port for coil 1 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coil1_pin</td><td>GPIO pin for coil 1 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coil2_port</td><td>GPIO port for coil 2 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coil2_pin</td><td>GPIO pin for coil 2 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coil3_port</td><td>GPIO port for coil 3 </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coil3_pin</td><td>GPIO pin for coil 3 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>HAL_OK on success, HAL_ERROR if hheater is NULL </dd></dl>

<p class="definition">Definition at line <a class="el" href="heater_8c_source.html#l00053">53</a> of file <a class="el" href="heater_8c_source.html">heater.c</a>.</p>

<p class="reference">References <a class="el" href="heater_8c_source.html#l00023">heater_set_default_params()</a>, <a class="el" href="main_8c_source.html#l00076">hheater</a>, and <a class="el" href="main_8c_source.html#l00072">htemp</a>.</p>

<p class="reference">Referenced by <a class="el" href="main_8c_source.html#l00112">main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="heater_8h_a972087cb00b2551215bec518ee3a2646_cgraph.svg" width="264" height="54"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="heater_8h_a972087cb00b2551215bec518ee3a2646_icgraph.svg" width="186" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_c6310732a22f63c0c2fc5595561e68f1.html">Core</a></li><li class="navelem"><a href="dir_e2489e887f17afa3cbc07a4ec152cdd2.html">Inc</a></li><li class="navelem"><a href="heater_8h.html">heater.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
</body>
</html>
